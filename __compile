#!/bin/bash
shopt -s nullglob

echo
echo '====================='
echo 'Generating files...'
echo '====================='
echo

FILES=( "$@" )
if [ ${#FILES[@]} -eq 0 ]; then
	rm out/*
	./basic
	./notenames
	./diatonic
	./interval
	./scales
	./scales-dorian
	./scales-melodic
	./scales-harmonic
	./scales-exercise
	FILES=(out/*.ly)
fi

# echo ${#FILES[@]}
# echo ${FILES[*]}
echo
echo '================================'
echo 'Compiling the generated files...'
echo '================================'
echo

function max2 {
   while [ `jobs | wc -l` -ge 5 ]
   do
      sleep 0.5
   done
}

cd out
for  i in  "${FILES[@]}" # "$@";
do
	max2
	echo "${i##*/}"
	lilypond -I /home/ats/Documents/lilypond/include/ "${i##*/}" 2> /dev/null &
done;

beep

# lilypond -I /home/ats/Documents/lilypond/include/ *.ly
