#!/bin/bash

OUTPUT_DIR="out"
DEBUG="false"
GENERATOR="c"
POSITIONAL=()

# https://stackoverflow.com/a/14203146
while [[ $# -gt 0 ]]; do
    case "$1" in
        -o|--output)
          OUTPUT_DIR="$2"
          shift 
          shift
        ;;
        -d|--debug)
          DEBUG="$2"
          shift
          shift
          ;;
        -g|--generator)
          GENERATOR="$2"
          shift
          shift
          ;;
        *) # unknown option
          POSITIONAL+=("$1") # save it in an array for later
          shift
          ;;
    esac
done
set -- "${POSITIONAL[@]}" # restore positional parameters

cat <<- EOF
// This file is automatically generated by $(basename $0)
// on $(date).

// Initialization.
require( 'chromatic' );

// Create the formatter.
var ScaleGenerator = require( 'chromatic/formatter' );

// Common Constant Values
var OUTPUT_DIR = '$OUTPUT_DIR/';
var MSG_HARMONIC_TO_ENHARMONIC = 'Harmonic First, Enharmonic Last';
var MSG_ENHARMONIC_TO_HARMONIC = 'Enharmonic First, Harmonic Last';

var DEBUG = $DEBUG;
var $GENERATOR = new ScaleGenerator( OUTPUT_DIR /*, 'basic' */ );

if ( DEBUG ) {
    $GENERATOR.setDevelopmentMode( true );
}

// $GENERATOR.disable();
// $GENERATOR.setAlwaysOutputHeader( true );

EOF

for FILE in "$@"; do
    echo
    echo "// >>> $FILE ==================================================="
    echo
    cat $FILE
    echo
    echo "// <<< $FILE ==================================================="
    echo
done

cat <<- EOF
c.close();


EOF
