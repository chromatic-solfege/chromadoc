function createTemplate( arr, sourceFilename, templateFilename ) {
	// LATE_GEN_2018 sourceFilename is not valid anymore. 
	if ( sourceFilename )
		throw new Error( "sourceFilename is not implemented. See tag LATE_GEN_2018." );

	var result = "";
	if ( ! templateFilename ) 
		templateFilename = "chromatic-solfege-gen.ly";

result += `
\\version "2.18.2"
\\include "aaron.ly"
\\include "${templateFilename}"
\\include "lilypond-book-preamble.ly"
\\language "aaron"

`;

	function createBlock( filename, caption, notes, lyrics ) {
		var result =  "";
		if ( caption ) {
			result +=
(`
\\markup \\bold \\italic {
    ${caption}
}
`);
		}

		result +=
`
\\makescore 
  #"${ filename }"
  \\relative do' {
    ${notes}
  }
`;
		return result;
	}

	for ( var i=0; i<arr.length; i++ ) {
		var e= arr[i];
		result += createBlock( e.filename, e.caption, e.notes, e.lyrics );
	}
	return result.trim();
}

if ( module && module.exports ) {
	module.exports = createTemplate;
}
